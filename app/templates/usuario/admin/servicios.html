<div class="h-full flex flex-col">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-bold text-gray-200">Servicios</h2>
    <button
      id="btn-abrir-modal-servicio"
      class="flex items-center gap-2 bg-rose-600 hover:bg-rose-700 text-white px-4 py-2 rounded-md font-medium transition"
    >
      <span class="text-lg leading-none">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="size-5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 4.5v15m7.5-7.5h-15"
          />
        </svg>
      </span>
      <span>Añadir Servicio</span>
    </button>
  </div>

  <!-- Tabla de servicios -->
  <style>
  #servicios-tbody td {
    padding: 0.75rem 1rem;
  }
  #servicios-tbody .servicio-thumb {
    width: 3rem;
    height: 3rem;
    object-fit: contain;
    border-radius: 0.375rem;
    border: 1px solid #4b5563;
  }
</style>
<div
    class="flex-1 bg-gray-900 shadow-md rounded-lg border border-gray-600 overflow-hidden"
  >
    <div class="overflow-x-auto h-full">
      <table class="min-w-full divide-y divide-gray-700">
        <thead class="bg-gray-700 sticky top-0">
          <tr>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              ID
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              Nombre
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              Imagen
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              Descripción
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              Precio
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              Duración (min)
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              Transferido
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              Descuento
            </th>
            <th
              class="px-4 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider"
            >
              Acciones
            </th>
          </tr>
        </thead>
        <tbody
          id="servicios-tbody"
          class="bg-gray-800 divide-y divide-gray-700"
        >
          <!-- Servicios cargados dinámicamente por JS -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal: Añadir Servicio -->
<div
  id="modal-servicio"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4 hidden"
>
  <div class="bg-white rounded-lg p-6 max-w-md w-full text-gray-900 relative">
    <button
      id="cerrar-modal-servicio"
      class="btn-cerrar-add absolute top-3 right-3 text-gray-400 hover:text-gray-700"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>
    <h3 class="text-xl font-bold mb-4">Añadir Servicio</h3>
    <form id="form-servicio-nuevo" enctype="multipart/form-data">
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Nombre</label>
        <input
          type="text"
          name="nombre"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-rose-500 focus:border-rose-500"
          required
        />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Descripción</label>
        <textarea
          name="descripcion"
          rows="2"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-rose-500 focus:border-rose-500"
        ></textarea>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Precio </label>
        <input
          type="number"
          name="precio"
          id="nuevo-precio"
          step="0.01"
          min="0"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-rose-500 focus:border-rose-500"
          required
        />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Duración (minutos)</label>
        <input
          type="number"
          name="duracion"
          min="1"
          step="1"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-rose-500 focus:border-rose-500"
          placeholder="Ej: 30"
          required
        />
      </div>
      {% if session.get('rol') == 'superadmin' %}
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Transferido</label>
        <input
          type="number"
          name="transferido"
          id="nuevo-transferido"
          step="0.01"
          min="0"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-rose-500 focus:border-rose-500"
        />
      </div>
      {% endif %}
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Imagen</label>
        <input
          type="file"
          name="imagen"
          accept="image/*"
          class="w-full text-gray-700"
        />
      </div>
      <button
        type="button"
        id="abrir-modal-descuento-nuevo"
        class="mb-3 text-rose-600 hover:text-rose-700 font-medium flex items-center gap-2"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 6v6m0 0v6m0-6h6m-6 0H6"
          />
        </svg>
        Añadir Descuento
      </button>
      <input type="hidden" name="descuento_tipo" id="nuevo-descuento-tipo" />
      <input type="hidden" name="descuento_valor" id="nuevo-descuento-valor" />
      <input
        type="hidden"
        name="descuento_fecha_inicio"
        id="nuevo-descuento-fecha-inicio"
      />
      <input
        type="hidden"
        name="descuento_fecha_fin"
        id="nuevo-descuento-fecha-fin"
      />
      <div class="flex justify-end gap-3">
        <button
          type="button"
          class="btn-cerrar-add px-4 py-2 rounded-md border text-gray-600 hover:bg-gray-100"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="bg-rose-600 hover:bg-rose-700 text-white px-6 py-2 rounded-md font-medium transition"
        >
          Guardar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Editar Servicio -->
<div
  id="modal-editar-servicio"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4 hidden"
>
  <div class="bg-white rounded-lg p-6 max-w-md w-full text-gray-900 relative">
    <button
      class="cerrar-modal-editar absolute top-3 right-3 text-gray-400 hover:text-gray-700"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>
    <h3 class="text-xl font-bold mb-4">Editar Servicio</h3>
    <form id="form-servicio-editar" enctype="multipart/form-data">
      <input type="hidden" name="id" id="edit-id" />
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Nombre</label>
        <input
          type="text"
          name="nombre"
          id="edit-nombre"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-rose-500 focus:border-rose-500"
          required
        />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Descripción</label>
        <textarea
          name="descripcion"
          id="edit-descripcion"
          rows="2"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-rose-500 focus:border-rose-500"
        ></textarea>
      </div>
      <div class="mb-3 flex gap-3">
        <div class="flex-1">
          <label class="block text-sm font-medium mb-1">Precio </label>
          <input
            type="number"
            name="precio"
            id="edit-precio"
            step="0.01"
            min="0"
            class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-rose-500 focus:border-rose-500"
            required
          />
        </div>
        <div class="flex-1">
          <label class="block text-sm font-medium mb-1">Duración (min)</label>
          <input
            type="number"
            name="duracion"
            id="edit-duracion"
            min="1"
            step="1"
            class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-rose-500 focus:border-rose-500"
            required
          />
        </div>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Transferido</label>
        <input
          type="number"
          name="transferido"
          id="edit-transferido"
          step="0.01"
          min="0"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-rose-500 focus:border-rose-500{{ ' bg-gray-100 cursor-not-allowed' if session.get('rol') != 'superadmin' else '' }}"
          {% if session.get('rol') != 'superadmin' %}readonly{% endif %}
        />
        {% if session.get('rol') != 'superadmin' %}<p class="text-xs text-gray-500 mt-1">Solo editable por superadministrador.</p>{% endif %}
      </div>
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Imagen (opcional)</label>
        <input
          type="file"
          name="imagen"
          accept="image/*"
          class="w-full text-gray-700"
        />
        <p class="text-xs text-gray-500 mt-1">
          Déjalo vacío para mantener la actual.
        </p>
        <div class="mt-2" id="preview-imagen-actual" hidden>
          <p class="text-xs text-gray-600 mb-1">Actual:</p>
          <img
            id="img-actual"
            src=""
            class="h-16 w-16 object-contain rounded border"
          />
        </div>
      </div>
      <button
        type="button"
        id="abrir-modal-descuento-editar"
        class="mb-3 text-rose-600 hover:text-rose-700 font-medium flex items-center gap-2"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 6v6m0 0v6m0-6h6m-6 0H6"
          />
        </svg>
        Añadir/Editar Descuento
      </button>
      <input type="hidden" name="descuento_tipo" id="edit-descuento-tipo" />
      <input type="hidden" name="descuento_valor" id="edit-descuento-valor" />
      <input
        type="hidden"
        name="descuento_fecha_inicio"
        id="edit-descuento-fecha-inicio"
      />
      <input
        type="hidden"
        name="descuento_fecha_fin"
        id="edit-descuento-fecha-fin"
      />
      <div class="flex justify-end gap-3">
        <button
          type="button"
          class="cerrar-modal-editar px-4 py-2 rounded-md border text-gray-600 hover:bg-gray-100"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="bg-rose-600 hover:bg-rose-700 text-white px-6 py-2 rounded-md font-medium transition"
        >
          Actualizar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Eliminar Servicio -->
<div
  id="modal-eliminar-servicio"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4 hidden"
>
  <div class="bg-white rounded-lg p-6 max-w-sm w-full text-gray-900 relative">
    <button
      class="cerrar-modal-eliminar absolute top-3 right-3 text-gray-400 hover:text-gray-700"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>
    <h3 class="text-lg font-bold mb-3">Eliminar Servicio</h3>
    <p class="text-sm text-gray-600 mb-4">
      ¿Seguro que deseas eliminar
      <span id="eliminar-nombre" class="font-semibold"></span>? Esta acción no
      se puede deshacer.
    </p>
    <form id="form-servicio-eliminar">
      <input type="hidden" name="id" id="eliminar-id" />
      <div class="flex justify-end gap-3">
        <button
          type="button"
          class="cerrar-modal-eliminar px-4 py-2 rounded-md border text-gray-600 hover:bg-gray-100"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-md font-medium transition"
        >
          Eliminar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Gestionar Descuento -->
<div
  id="modal-descuento"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4 hidden"
>
  <div class="bg-white rounded-lg p-6 max-w-md w-full text-gray-900 relative">
    <button
      id="cerrar-modal-descuento"
      class="absolute top-3 right-3 text-gray-400 hover:text-gray-700"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>
    <h3 class="text-xl font-bold mb-4">Gestionar Descuento</h3>
    <form id="form-descuento">
      <input type="hidden" name="context" id="descuento-context" />
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Tipo de Descuento</label>
        <select
          id="descuento-tipo-select"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-rose-500 focus:border-rose-500"
        >
          <option value="porcentaje">Porcentaje (%)</option>
          <option value="cantidad">Cantidad Fija</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Porcentaje (%)</label>
        <input
          type="number"
          id="descuento-porcentaje"
          step="0.01"
          min="0"
          max="100"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-rose-500 focus:border-rose-500"
        />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Cantidad Fija </label>
        <input
          type="number"
          id="descuento-cantidad"
          step="0.01"
          min="0"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-rose-500 focus:border-rose-500"
        />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Precio Final </label>
        <input
          type="number"
          id="descuento-precio-final"
          step="0.01"
          class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100"
          readonly
        />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1">Fecha Inicio</label>
        <input
          type="date"
          id="descuento-fecha-inicio"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-rose-500 focus:border-rose-500"
          required
        />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium mb-1"
          >Fecha Fin (opcional)</label
        >
        <input
          type="date"
          id="descuento-fecha-fin"
          class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-rose-500 focus:border-rose-500"
        />
      </div>
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <button
          type="button"
          id="eliminar-descuento"
          class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md font-medium transition w-full sm:w-auto"
          hidden
        >
          Eliminar Descuento
        </button>
        <button
          type="submit"
          class="bg-rose-600 hover:bg-rose-700 text-white px-6 py-2 rounded-md font-medium transition w-full sm:w-auto"
        >
          Guardar Descuento
        </button>
      </div>
    </form>
  </div>
</div>

<script src="{{ url_for('static', filename='js/servicios.js') }}?v=2"></script>

{% extends 'base.html' %}
{% block title %}Reservar Cita{% endblock %}

{% block content %}
<section id="reservar" class="py-16 pt-28 bg-rose-600 text-white">
    <div class="container mx-auto px-4">
        <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-bold mb-4">RESERVA TU CITA</h2>
            <div class="w-24 h-1 bg-white mx-auto"></div>
            <p class="mt-4 max-w-2xl mx-auto">Reserva tu cita en línea y evita esperas. Nuestro equipo estará listo para atenderte.</p>
        </div>
                
        <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-xl p-8 text-gray-800">
            <form id="reservation-form" method="POST" action="{{ url_for('cita.reservar_cita') }}">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Datos personales y detalles de la cita -->
                    <div>
                        <label for="name" class="block text-gray-700 font-medium mb-2">Nombre completo</label>
                        <input type="text" id="name" name="name" value="{{ session['nombre'] }} {{ session['apellido'] }}" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500" required>
                    </div>
                    
                    <div>
                        <label for="phone" class="block text-gray-700 font-medium mb-2">Teléfono</label>
                        <input type="tel" id="phone" name="phone" value="{{ session['telefono'] }}" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500" required>
                    </div>
                    
                    <div>
                        <label for="date" class="block text-gray-700 font-medium mb-2">Fecha</label>
                        <input type="date" id="date" name="date" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500" required>
                    </div>
                    
                    <div>
                        <label for="time" class="block text-gray-700 font-medium mb-2">Hora</label>
                        <select id="time" name="time" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500" required>
                            <option value="">Seleccionar hora</option>
                            <option value="09:00">9:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="12:00">12:00 PM</option>
                            <option value="14:00">2:00 PM</option>
                            <option value="15:00">3:00 PM</option>
                            <option value="16:00">4:00 PM</option>
                            <option value="17:00">5:00 PM</option>
                            <option value="18:00">6:00 PM</option>
                            <option value="19:00">7:00 PM</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="barber" class="block text-gray-700 font-medium mb-2">Barbero</label>
                        <select id="barber" name="barber" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500" required>
                            <option value="">Seleccionar barbero</option>
                            {% for barbero in barberos %}
                                <option value="{{ barbero.id }}">{{ barbero.nombre }} {{ barbero.apellido }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Sección de servicios (en una sola columna) -->
                <div class="mt-6">
                    <label for="service_id" class="block font-medium text-gray-700 mb-2">Servicio</label>
                    <select id="service_id" name="service_id" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500"
                            {% if not servicios or servicios|length == 0 %}disabled{% else %}required{% endif %}
                            onchange="updateSecondServiceOptions()">
                        {% if servicios and servicios|length > 0 %}
                        <option value="">Selecciona un servicio</option>
                        {% for s in servicios %}
                            <option value="{{ s.id }}">{{ s.nombre }}</option>
                        {% endfor %}
                        {% else %}
                        <option value="" selected>No hay servicios disponibles</option>
                        {% endif %}
                    </select>
                    {% if not servicios or servicios|length == 0 %}
                        <p class="mt-2 text-sm text-gray-500">Aún no hay servicios. Intenta más tarde.</p>
                    {% endif %}
                </div>

                <!-- Botón Añadir servicio (debajo del servicio principal) -->
                <div id="add-service-btn-container" class="mt-3 hidden">
                    <button type="button" id="add-service-btn" class="flex items-center text-rose-600 hover:text-rose-700">
                        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Añadir servicio adicional
                    </button>
                </div>

                <!-- Segundo servicio (oculto inicialmente, debajo del botón) -->
                <div id="second-service-container" class="mt-3 hidden">
                    <label for="second_service_id" class="block font-medium text-gray-700 mb-2">Servicio adicional</label>
                    <div class="flex items-center gap-2">
                        <select id="second_service_id" name="second_service_id" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500">
                            <option value="">Selecciona un servicio adicional</option>
                            <!-- Las opciones se llenarán dinámicamente con JS -->
                        </select>
                        <button type="button" id="remove-second-service" class="text-red-500 hover:text-red-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                                
                <div class="mt-6">
                    <label for="notes" class="block text-gray-700 font-medium mb-2">Notas adicionales</label>
                    <textarea id="notes" name="notes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500" placeholder="Escribe cualquier solicitud especial..."></textarea>
                </div>
                            
                <div class="mt-8">
                    <button
                        type="submit"
                        {% if not servicios or servicios|length == 0 %}disabled{% endif %}
                        class="w-full bg-rose-600 hover:bg-rose-700 text-white py-3 rounded-md font-medium text-lg transition duration-300 {% if not servicios or servicios|length == 0 %}opacity-60 cursor-not-allowed{% endif %}">
                        Confirmar Reserva
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- Modal de éxito -->
<div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4 {% if exito is defined and exito %}block{% else %}hidden{% endif %}">
    <div class="bg-white rounded-lg p-8 max-w-md w-full text-center">
        <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6">
            <i class="fas fa-check text-2xl text-green-600"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-2">¡Cita enviada!</h3>
        <p class="text-gray-600 mb-6">Tu cita ha sido registrada correctamente. Pronto recibirás confirmación.</p>
        <button id="close-modal" class="bg-rose-600 hover:bg-rose-700 text-white px-6 py-2 rounded-md font-medium transition">Cerrar</button>
    </div>
</div>

<!-- Modal de error -->
<div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4 {% if exito is defined and not exito %}block{% else %}hidden{% endif %}">
    <div class="bg-white rounded-lg p-8 max-w-md w-full text-center">
        <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-6">
            <i class="fas fa-times text-2xl text-red-600"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-2">¡Error!</h3>
        <p class="text-gray-600 mb-6">
            {% if error_message is defined %}
                {{ error_message }}
            {% else %}
                Ocurrió un error al registrar tu cita. Intenta nuevamente.
            {% endif %}
        </p>
        <button id="close-error-modal" class="bg-rose-600 hover:bg-rose-700 text-white px-6 py-2 rounded-md font-medium transition">Cerrar</button>
    </div>
</div>
{% endblock %}